;;

title = "books"
url = "/:universe/book"
layout = "default"
is_hidden = 0

==

use Fw\Backend\Models\Book as Book;

function onStart()
{
    // Template
    $this['template'] = "right-sidebar";

    $this['records'] = \Fw\Backend\Models\Content::where('permalink', 'LIKE', '%' . $_SERVER['REQUEST_URI'] . '%')
    ->with('category')
    ->with('contentable')
    ->get()
    ->sortBy('contentable.number_in_series')
    ->sortBy('category.title');

    $this['page_title'] = "Книги";

    $this['universe'] = $this->param('universe');
}

==
{##}
{% partial 'layout/universe-menu' %}
{% partial 'layout/page-title' %}

{% put content %}

{% set last_char = '' %}
{% for record in records %}

{% if record.category.title == 'books' %}
    {% set series = 'Вне серии' %}
{% else %}
    {% set series = record.category.title %}
{% endif %}

{% set this_char = series %}
{% if this_char != last_char %}
{% if last_char != '' %}
</div>
{% endif %}
{% set last_char = this_char%}
<h2> {{ this_char }} </h2>
<div class="card_list">
    {% endif %}
    <div class="card-item">
        <div class="card">
            <a href="{{record.permalink }}">
                <div class="card__image">
                    <img src="{{ record.contentable.cover.path }}" alt="{{ record.title }}" />
                </div>
                <div class="card__content">
                    <h4>{{ record.title }}</h4>
                    <div class="h4-subtitle"> {{ record.title_ru }} </div>
                    {% for author in record.contentable.author %}
                        <a href="{{ author.content.permalink }}"> {{ author.title }} </a>
                    {% endfor %}
                </div>
            </a>
        </div>
    </div>
    {% endfor %}
</div>

{% endput %}

{% put sidebar_top %}
{% endput %}


{% put sidebar_bottom %}
    {% partial 'widgets/advertisment' %}
{% endput %}